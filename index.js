// —Ç–æ–∫–µ–Ω –±–µ—Ä–µ–º —Å .env —Ñ–∞–π–ª–∞
require('dotenv').config()
const token = process.env.BOT_TOKEN
// –±–µ—Ä–µ–º –∞–ø–∏—à–∫—É
const TelegramApi = require('node-telegram-bot-api')

// —Å–æ–∑–¥–∞–µ–º –±–æ—Ç–∞, –¥–µ–ª–∞—è –µ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ã(—Ç–æ–∫–µ–Ω –∏ –ø—Ä–æ—á–∞—è —Ö—É–π–Ω—è –∫–∞—Ä–æ—á–µ —Å—ã—Ä –∑–∞–ª—É–ø–∞)
const bot = new TelegramApi(token, {polling: true})


// —Ç—É—Ç –∫–æ—Ä–æ—á —Ç–µ–º–∫–∞ —à–æ–± –∫–æ–≥–¥–∞ –Ω–∞–∂–∏–º–∞–ª –∫–Ω–æ–ø–∫—É –≤–æ–∑–ª–µ —á–∞—Ç–∞ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —É–¥–æ–±–Ω–æ –∫–æ—Ä–æ—á
bot.setMyCommands([
    {command: '/start', description: '–Ω–∞—á–∞–ª–æ'},
    {command: '/account', description: '–º–æ–π –∞–∫–∫–∞—É–Ω—Ç'},
    {command: '/help', description: '—Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥'},
    {command: '/cheese', description: '–ø–æ–∫–∞–∑–∞—Ç—å —Å—ã—Ä—ã (–±–æ–Ω—É—Å—ã)'} 
])
console.log('bot running...')

const start = () => {
    bot.on('message', async msg => {
        // —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∫ –Ω–∏–º –≥—Ä—É–±–æ –≥–æ–≤–æ—Ä—è –∫–æ—Ä–æ—Ç–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —à–æ–±—ã –∫—Ä–∞—Å–∏–≤–æ –≤—Å–µ —Å–º–æ—Ä–µ–ª–æ—Å—å –Ω–µ —Å—ã—Ä–Ω–æ
        const chatId = msg.chat.id
        const text = msg.text
        // –±–∞–ª–∞–Ω—Å –≤ —Ä—É–±–ª—è—Ö –∏ –±–æ–Ω—É—Å–Ω—ã–µ —Å—ã—Ä—ã —Ç–∞–∫–∂–µ —Ç–æ—Ç –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫
        let balance = Math.floor(Math.random() * 5000); // –±–∞–ª–∞–Ω—Å —Å–ª—É—á–∞–π–Ω—ã–π –¥–ª—è –ø—Ä–∏–∫–æ–ª–∞
        let cheese = Math.floor(Math.random() * 20); // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã—Ä–∞ (–±–æ–Ω—É—Å–æ–≤)
        let whitelist = false;

        // –∫–æ–º–∞–Ω–¥–∞ —Å—Ç–∞—Ä—Ç
        if (text === '/start') {
            bot.sendSticker(chatId, 'https://tlgrm.ru/_/stickers/76b/596/76b59687-4b1f-383f-80e1-8289192f8bb2/12.webp')
            bot.sendMessage(chatId, 'üßÄ –∑–¥–∞—Ä–æ–≤–∞ üßÄ, —Ö–æ—á–µ—à—å –∫–æ–º—É —Ç–æ –Ω–∞–µ–±–∞—à–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –≥—É–¥–∫–∞–º–∏ –∏–ª–∏ —Å–º—Å–∫–∞–º–∏, —Ç–µ–±–µ –∫ –Ω–∞–º! \n\n –°–Ω–∏–∑—É —É–≤–∏–¥–∏—à—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —ç—Ç–æ–≥–æ –µ–±–∞–Ω–æ–≥–æ –±–æ—Ç–∞')
        }

        // –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è —Å—ã—Ä–æ–≤
        if (text === '/account') {
            bot.sendMessage(chatId, 
                `üè¶ –¢–≤–æ–π –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç , ${msg.from.first_name}üßÄ \n\n` +
                `üí≥ –±–∞–ª–∞–Ω—Å: ${balance} ‚ÇΩ\n` +
                `üßÄ –±–æ–Ω—É—Å—ã (—Å—ã—Ä—ã): ${cheese}\n` +
                `üìÑ –≤ –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ: ${whitelist ? '–¥–∞üîí' : '–Ω–µ—Çüîì'}`
            )
        }

        // –æ–±—ã—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
        if (text === '/help') {
            bot.sendMessage(chatId, 
                'üìñ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥:\n' +
                '/start ‚Äì –∑–∞–ø—É—Å–∫\n' +
                '/account ‚Äì –º–æ–π –∞–∫–∫–∞—É–Ω—Ç\n' +
                '/cheese ‚Äì –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ –±–æ–Ω—É—Å—ã (—Å—ã—Ä—ã)\n' +
                '/help ‚Äì –ø–æ–º–æ—â—å'
            )
        }

        // –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–æ–Ω—É—Å—ã
        if (text === '/cheese') {
            bot.sendMessage(chatId, `üßÄ —É —Ç–µ–±—è ${cheese} –±–æ–Ω—É—Å–Ω—ã—Ö –∫—É—Å–æ—á–∫–æ–≤ —Å—ã—Ä–∞`)
        }
    })

}

// –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
start()
// —à–æ–± –Ω–∞—Ö–æ–¥–∏–ª–æ —Å—ã—Ä–Ω—ã–µ –æ—à—ã–±–∫–∏
bot.on('polling_error', console.error)
